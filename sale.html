<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    html, body {
      touch-action: manipulation;
      overscroll-behavior: contain;
    }
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Kinaya Rising POS</title>

  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Audiowide&family=Libre+Barcode+128&family=Roboto:wght@300;400;700&display=swap"
    rel="stylesheet"
  />

  <link rel="stylesheet" href="styles.css" />
  <script>
    if (sessionStorage.getItem("posUnlocked") !== "true") {
      window.location.href = "index.html";
    }
  </script>
  <script src="script.js" defer></script>
</head>

<!-- ====== NAVIGATION ====== -->
  <nav class="kinaya-nav">
    <a href="sale.html" class="nav-btn active">
      <i class="fas fa-cash-register"></i>
      <span>Sales</span>
    </a>
    <a href="inventory.html" class="nav-btn">
      <i class="fas fa-boxes"></i>
      <span>Inventory</span>
    </a>
    <a href="data.html" class="nav-btn">
      <i class="fas fa-chart-line"></i>
      <span>Data</span>
    </a>
  </nav>
<body>
  <header>
  <h1>Purchase Order</h1>
  <div id="return-mode-banner" style="
  display:none;
  background:#e63946;
  color:#fff;
  text-align:center;
  font-weight:bold;
  padding:6px 0;
  font-size:1.1rem;
  letter-spacing:1px;
  text-shadow:0 0 6px rgba(0,0,0,0.3);
  animation:pulseGlow 1.2s infinite;
">
  üî¥ RETURN MODE ACTIVE
</div>
</header>

<main class="main-container flex-row">
  <section class="order flex-column">
    <article class="receipt flex-column">

      <!-- ‚îÄ‚îÄ‚îÄ Company Info ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="company-info flex-column">
        <p id="company-name">Kinaya Rising</p>
        <p id="company-website">KinayaRising.com</p>
        <p id="company-email">KinayaRising@gmail.com</p>
        <p id="invoice-number">Invoice #1000</p>
        <p id="current-date"></p>
      </div>

      <!-- ‚îÄ‚îÄ‚îÄ Receipt Table ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="receipt-details">
        <table class="details-details">
          <thead>
            <tr><td class="dotted-border" colspan="5"></td></tr>
            <tr><td class="empty-border" colspan="5"></td></tr>
            <tr>
              <th class="product-name">Product Name</th>
              <th class="quantity">Qty</th>
              <th class="price">Price</th>
              <th class="subtotal">Sub</th>
              <th class="delete">Del</th>
            </tr>
            <tr><td class="dotted-border" colspan="5"></td></tr>
            <tr><td class="empty-border" colspan="5"></td></tr>
          </thead>

          <tbody id="receipt-details"></tbody>
        </table>

        <!-- ‚îÄ‚îÄ‚îÄ Summary Table ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div class="receipt-summary">
          <table class="summary-table">
            <tbody id="summary-section">

              <!-- Section Divider -->
              <tr><td class="dotted-border" colspan="3"></td></tr>
              <tr><td class="empty-border" colspan="3"></td></tr>

              <!-- Totals -->
              <tr><td>Subtotal:</td><td id="subtotal-summary">$0.00</td></tr>
              <tr><td>Tax:</td><td id="tax-summary">$0.00</td></tr>
              <tr><td>Grand Total:</td><td id="grandtotal-summary">$0.00</td></tr>

              <!-- Divider -->
              <tr><td class="dotted-border" colspan="3"></td></tr>
              <tr><td class="empty-border" colspan="3"></td></tr>

              <!-- Payment Info -->
              <tr>
                <td>Amount Paid:</td>
                <td colspan="2">
                  <input 
                    type="number" 
                    id="amount-paid-input" 
                    step="0.01" 
                    min="0" 
                    placeholder="0.00"
                    style="width:100%;padding:4px;border-radius:4px;"
                  />
                </td>
              </tr>

              <tr>
                <td id="change-title">Change:</td>
                <td id="change-amount">$0.00</td>
              </tr>

              <tr>
                <td>Payment Type:</td>
                <td id="split-info">None</td>
              </tr>

              <!-- Divider -->
              <tr><td class="dotted-border" colspan="3"></td></tr>
              <tr><td class="empty-border" colspan="3"></td></tr>

              <!-- Email Info -->
              <tr>
                <td>Email:</td>
                <td colspan="2">
                  <input
                    type="email"
                    id="customer-email"
                    placeholder="customer@example.com"
                    style="
                      width:100%;
                      padding:4px;
                      border:1px solid #333;
                      border-radius:4px;
                      background:#111;
                      color:#A7E1EE;
                    "
                  />
                </td>
              </tr>

              <tr>
                <td>Share Email?</td>
                <td>
                  <label class="switch">
                    <input type="checkbox" id="email-toggle" checked />
                    <span class="slider"></span>
                  </label>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Submit Row -->
          <div id="submit-row" style="display:none; text-align:center; padding:1rem 0;">
            <button id="submit-sale" class="submit-sale-btn">Submit Sale</button>
          </div>
        </div>

        <!-- Footer -->
        <div class="receipt-footer">Thank You For Your Support!</div>

        <!-- Toolbar -->
        <div class="toolbar flex-row">
          <button id="cash-btn" class="toolbar-btn" title="Cash Payment">
            <i class="fa-solid fa-money-bill-wave"></i>
          </button>
          <button id="card-btn" class="toolbar-btn" title="Card Payment">
            <i class="fa-solid fa-credit-card"></i>
          </button>
          <button id="clear-order-btn" class="toolbar-btn" title="Clear Order">
            <i class="fa-solid fa-trash"></i>
          </button>
          <button id="toggle-return" class="toolbar-btn" title="Toggle Return Mode">
            <i class="fa-solid fa-rotate-left"></i>
          </button>
        </div>

      </div>
    </article>
  </section>

  <!-- Product Menu -->
  <section class="menu-payment grid">
    <div class="menu flex-row" id="menu"></div>
  </section>
</main>

            <div id="submit-row" style="display:none; text-align:center; padding:1rem 0;">
              <button id="submit-sale" class="submit-sale-btn">Submit Sale</button>
            </div>
          </div>

          <div class="receipt-footer">Thank You For Your Support!</div>


      </article>
    </section>

    <section class="menu-payment grid">
      <div class="menu flex-row" id="menu"></div>
    </section>
  </main>
  <button id="open-product-overlay" class="add-products-btn">
  <i class="fa-solid fa-plus"></i> Add Products
</button>


  <div id="submit-modal" class="modal hidden">
    <div class="modal-content">
      <p>‚úÖ Payment complete! Submit this ticket?</p>
      <div class="modal-buttons">
        <button id="modal-cancel">Cancel</button>
        <button id="modal-ok">OK</button>
      </div>
    </div>
  </div>

  <div id="payment-overlay" class="hidden">
  <div class="paypad" id="paypad">
    <button id="close-paypad-btn" class="paypad-close" title="Close">
      <i class="fa-solid fa-xmark"></i>
    </button>

    <div id="paypad-display" class="paypad-display">$0</div>

    <button class="paypad-btn number" data-value="7">7</button>
    <button class="paypad-btn number" data-value="8">8</button>
    <button class="paypad-btn number" data-value="9">9</button>
    <button class="paypad-btn number" data-value="4">4</button>
    <button class="paypad-btn number" data-value="5">5</button>
    <button class="paypad-btn number" data-value="6">6</button>
    <button class="paypad-btn number" data-value="1">1</button>
    <button class="paypad-btn number" data-value="2">2</button>
    <button class="paypad-btn number" data-value="3">3</button>
    <button class="paypad-btn number" data-value="0">0</button>
    <button class="paypad-btn" data-value="C">C</button>
    <button class="paypad-btn" data-value="‚Üê">‚Üê</button>
    <button class="paypad-btn span3-col" data-value="Enter">Enter</button>
  </div>
  </div>
  <!-- Mobile-only Add Products button -->
<button id="open-product-overlay" class="mobile-add-btn">
  <i class="fa-solid fa-plus"></i> Add Products
</button>

<!-- Fullscreen Product Overlay -->
<div id="product-overlay" class="product-overlay hidden" aria-hidden="true">
  <div class="overlay-header">
    <button id="toggle-return" class="toolbar-btn" title="Toggle Return Mode">
            <i class="fa-solid fa-rotate-left"></i>
          </button>
    <span id="overlay-subtotal-summary" class="overlay-subtotal">$0.00</span>
    <button id="close-product-overlay" class="overlay-close" aria-label="Close">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div id="overlay-grid" class="overlay-grid"></div>
</div>


<script>
// ===========================================================
// üåø Kinaya Rising POS ‚Äî Receipt + Overlay Integration
// ===========================================================
document.addEventListener("DOMContentLoaded", () => {
  const openBtn = document.getElementById("open-product-overlay");
  const closeBtn = document.getElementById("close-product-overlay");
  const overlay = document.getElementById("product-overlay");
  const overlayGrid = document.getElementById("overlay-grid");
  const overlayReturnBtn = document.querySelector(".overlay-header #toggle-return");
  const headerBanner = document.getElementById("return-mode-banner");
  const menu = document.getElementById("menu");
  const receiptBody = document.getElementById("receipt-details");
  const subtotalEl = document.getElementById("subtotal-summary");
  const taxEl = document.getElementById("tax-summary");
  const grandEl = document.getElementById("grandtotal-summary");

  const TAX_RATE = 0.07;
  let isReturnMode = false;
  let receiptItems = [];

  // === PRODUCT DATA ===
  const allProducts = [
    { title: "Book - AoL Part 1", sku: "B0F8NFSWXW", price: 14.98, img: "https://raw.githubusercontent.com/komuna84/kinaya-pos-assets/main/B0F8NFSWXW.png" },
    { title: "Bookmarks", sku: "BKM-001", price: 2.00, img: "https://raw.githubusercontent.com/komuna84/kinaya-pos-assets/main/bookmark.png" }
  ];

  // === RENDER PRODUCTS IN MENU ===
  function renderMenu() {
    menu.innerHTML = "";
    allProducts.forEach(p => {
      const item = document.createElement("figure");
      item.className = "menu-item";
      item.innerHTML = `
        <img src="${p.img}" alt="${p.title}">
        <figcaption>${p.title}</figcaption>
        <figcaption>${p.sku}</figcaption>
        <figcaption>$${p.price.toFixed(2)}</figcaption>
      `;
      menu.appendChild(item);
    });
  }

  // === RENDER RECEIPT ===
  function renderReceipt() {
    receiptBody.innerHTML = "";
    receiptItems.forEach((p, i) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${p.title}</td>
        <td>${p.qty}</td>
        <td>$${p.price.toFixed(2)}</td>
        <td>$${(p.price * p.qty).toFixed(2)}</td>
        <td><button class="delete-btn" data-index="${i}" title="Remove"><i class="fa-solid fa-xmark"></i></button></td>
      `;
      receiptBody.appendChild(row);
    });
    updateTotals();
  }

  // === UPDATE TOTALS ===
  function updateTotals() {
    let subtotal = 0;
    receiptItems.forEach(p => subtotal += p.price * p.qty);
    const tax = subtotal * TAX_RATE;
    const grand = subtotal + tax;

    subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
    taxEl.textContent = `$${tax.toFixed(2)}`;
    grandEl.textContent = `$${grand.toFixed(2)}`;
  }

  // === ADD PRODUCT TO RECEIPT ===
  function addProduct(productData) {
    const existing = receiptItems.find(p => p.sku === productData.sku);
    if (existing) {
      existing.qty += 1;
    } else {
      receiptItems.push({ ...productData, qty: 1 });
    }
    renderReceipt();
  }

  // === DELETE PRODUCT ROW ===
  receiptBody.addEventListener("click", (e) => {
    const delBtn = e.target.closest(".delete-btn");
    if (!delBtn) return;
    const index = parseInt(delBtn.dataset.index);
    receiptItems.splice(index, 1);
    renderReceipt();
  });

  // === OVERLAY OPEN/CLOSE ===
  const lockScroll = (lock) => document.body.style.overflow = lock ? "hidden" : "";
  openBtn?.addEventListener("click", () => {
    overlay.classList.remove("hidden");
    requestAnimationFrame(() => overlay.classList.add("active"));
    lockScroll(true);
  });
  closeBtn?.addEventListener("click", () => {
    overlay.classList.remove("active");
    lockScroll(false);
    setTimeout(() => overlay.classList.add("hidden"), 300);
  });

  // === ADD PRODUCT FROM MENU ===
  menu.addEventListener("click", (e) => {
    const card = e.target.closest(".menu-item");
    if (!card) return;

    const [titleEl, skuEl, priceEl] = card.querySelectorAll("figcaption");
    const product = {
      title: titleEl.textContent,
      sku: skuEl.textContent,
      price: parseFloat(priceEl.textContent.replace("$", "")),
      img: card.querySelector("img").src
    };

    addProduct(product);
  });

  // === RETURN MODE TOGGLE ===
  function toggleReturnMode() {
    isReturnMode = !isReturnMode;
    headerBanner.style.display = isReturnMode ? "block" : "none";
    overlayReturnBtn.classList.toggle("active", isReturnMode);
    console.log(`‚Ü©Ô∏è Return mode ${isReturnMode ? "ENABLED" : "DISABLED"}`);
  }
  overlayReturnBtn?.addEventListener("click", toggleReturnMode);

  // === INITIALIZE ===
  renderMenu();
});
</script>

</body>
</html>
