<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0b0b" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="description"
        content="Kinaya Rising POS ‚Äî Create and manage purchase orders, track payments, and process returns in a unified Kinaya interface." />
  <title>Kinaya Rising POS ‚Äî Purchase Order</title>

  <!-- ===== GLOBAL FONTS & ICONS ===== -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer" />
  <link
    href="https://fonts.googleapis.com/css2?family=Audiowide&family=Roboto:wght@300;400;700&display=swap"
    rel="stylesheet" />

  <!-- ===== KINAYA UNIFIED STYLES ===== -->
  <link rel="stylesheet" href="styles/kinaya-base.css" />
  <link rel="stylesheet" href="styles/pos.css" />

  <!-- ===== ACCESS LOCK ===== -->
  <script>
    if (sessionStorage.getItem("posUnlocked") !== "true") {
      window.location.href = "index.html";
    }
  </script>
</head>

<body>
  <!-- ===== HEADER ===== -->
  <header class="pos-header">
    <h1>Purchase Order</h1>
    <div id="return-mode-banner" class="return-banner">üî¥ RETURN MODE ACTIVE</div>
  </header>

  <!-- ===== NAVIGATION ===== -->
  <nav class="kinaya-nav">
    <a href="sale.html" class="nav-btn active">
      <i class="fas fa-cash-register"></i><span>Sales</span>
    </a>
    <a href="inventory.html" class="nav-btn">
      <i class="fas fa-boxes"></i><span>Inventory</span>
    </a>
    <a href="data.html" class="nav-btn">
      <i class="fas fa-chart-line"></i><span>Data</span>
    </a>
  </nav>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="main-container flex-row" role="main">

    <!-- ===== RECEIPT / ORDER SECTION ===== -->
    <section class="order flex-column glass-panel">
      <article class="receipt flex-column">
        <div class="company-info flex-column">
          <p id="company-name">Kinaya Rising</p>
          <p id="company-website">KinayaRising.com</p>
          <p id="company-email">KinayaRising@gmail.com</p>
          <p id="invoice-number">Invoice #1000</p>
          <p id="current-date"></p>
        </div>

        <div class="receipt-details">
          <table class="details-table">
            <thead>
              <tr><td class="dotted-border" colspan="5"></td></tr>
              <tr>
                <th>Product</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Sub</th>
                <th>Del</th>
              </tr>
              <tr><td class="dotted-border" colspan="5"></td></tr>
            </thead>
            <tbody id="receipt-details"></tbody>
          </table>

          <div class="receipt-summary">
            <table class="summary-table">
              <tbody id="summary-section">
                <tr><td>Subtotal:</td><td id="subtotal-summary">$0.00</td></tr>
                <tr><td>Tax:</td><td id="tax-summary">$0.00</td></tr>
                <tr><td>Grand Total:</td><td id="grandtotal-summary">$0.00</td></tr>
                <tr><td>Amount Paid:</td><td id="amount-paid-display" data-bind="amount-paid" class="glow-text">$0.00</td></tr>
                <tr><td>Change:</td><td id="change-amount" data-bind="change-due">$0.00</td></tr>
                <tr><td>Payment Type:</td><td id="split-info">None</td></tr>
                <tr><td>Email:</td>
                  <td><input type="email" id="customer-email" placeholder="customer@example.com" /></td>
                </tr>
                <tr><td>Share Email?</td>
                  <td>
                    <label class="switch">
                      <input type="checkbox" id="email-toggle" checked />
                      <span class="slider"></span>
                    </label>
                  </td>
                </tr>
              </tbody>
            </table>

            <div id="submit-row" class="submit-row hidden">
              <button id="submit-sale" class="submit-sale-btn glow-button">Submit Sale</button>
            </div>
          </div>

          <div class="receipt-footer">Thank You For Your Support!</div>

          <!-- ===== TOOLBAR ===== -->
          <div class="toolbar flex-row">
            <button id="cash-btn" class="toolbar-btn" title="Cash Payment">
              <i class="fa-solid fa-money-bill-wave"></i>
            </button>
            <button id="card-btn" class="toolbar-btn" title="Card Payment">
              <i class="fa-solid fa-credit-card"></i>
            </button>
            <button id="clear-order-btn" class="toolbar-btn" title="Clear Order">
              <i class="fa-solid fa-trash"></i>
            </button>
            <button id="toggle-return-main" class="toolbar-btn" title="Toggle Return Mode">
              <i class="fa-solid fa-rotate-left"></i>
            </button>
          </div>
        </div>
      </article>
    </section>

    <!-- ===== PRODUCT GRID ===== -->
    <section class="menu-payment grid">
      <div class="menu flex-row" id="menu"></div>
    </section>
    <button id="open-gallery" class="glow-button mobile-only">
  <i class="fa-solid fa-images"></i> View All Products
</button>

<div id="image-modal" class="image-modal hidden">
  <div class="modal-content">
    <span id="close-gallery" class="close-btn">&times;</span>
    <div id="image-gallery"></div>
  </div>
</div>

  </main>

  <!-- üí∞ PAYMENT OVERLAY (PAYPAD) -->
  <div id="payment-overlay" class="overlay">
    <div class="paypad">
      <button id="close-paypad-btn" class="close-paypad-icon">
        <i class="fa-solid fa-xmark"></i>
      </button>

      <h2 class="paypad-title">Enter Payment</h2>
      <div class="owed-section">
        <span class="owed-label">Amount Owed:</span>
        <span id="paypad-owed" class="owed-value">$0.00</span>
      </div>

      <div id="paypad-display" class="paypad-display" data-bind="amount-paid">$0.00</div>

      <div class="paypad-grid">
        <button class="paypad-btn" data-value="7">7</button>
        <button class="paypad-btn" data-value="8">8</button>
        <button class="paypad-btn" data-value="9">9</button>
        <button class="paypad-btn" data-value="‚Üê">‚Üê</button>

        <button class="paypad-btn" data-value="4">4</button>
        <button class="paypad-btn" data-value="5">5</button>
        <button class="paypad-btn" data-value="6">6</button>
        <button class="paypad-btn" data-value="C">C</button>

        <button class="paypad-btn" data-value="1">1</button>
        <button class="paypad-btn" data-value="2">2</button>
        <button class="paypad-btn" data-value="3">3</button>
        <button class="paypad-btn" data-value=".">.</button>

        <button class="paypad-btn" data-value="0">0</button>
        <button class="paypad-btn" data-value="00">00</button>
      </div>

      <button id="confirm-payment-btn" class="confirm-payment-btn glow-button">
        Confirm Payment
      </button>
    </div>
  </div>

  <!-- ===== JS MODULES ===== -->
  <script src="scripts/script.js" defer></script>
  <script src="scripts/sale.js" defer></script>

  <!-- üåø Split Payment + Overlay Fix -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    // ===== SPLIT PAYMENT LOGIC =====
    let cashPaid = 0;
    let cardPaid = 0;
    let activeMethod = "cash";
    let keypadBuffer = "";

    const money = v => `$${(Number(v) || 0).toFixed(2)}`;

    function syncDisplays() {
      const totalPaid = cashPaid + cardPaid;
      const owedEl = document.getElementById("paypad-owed");
      const owed = owedEl ? parseFloat(owedEl.textContent.replace(/[^0-9.]/g, "")) || 0 : 0;
      const change = Math.max(0, totalPaid - owed);

      document.querySelectorAll('[data-bind="amount-paid"]').forEach(el => el.textContent = money(totalPaid));
      document.querySelectorAll('[data-bind="change-due"]').forEach(el => el.textContent = money(change));

      const splitInfo = document.getElementById("split-info");
      if (splitInfo) {
        let parts = [];
        if (cashPaid > 0) parts.push(`$${cashPaid.toFixed(2)} Cash`);
        if (cardPaid > 0) parts.push(`$${cardPaid.toFixed(2)} Card`);
        splitInfo.textContent = parts.length ? parts.join(" + ") : "None";
      }
    }

    // ===== ELEMENTS =====
    const paypadOverlay = document.getElementById("payment-overlay");
    const paypadDisplay = document.getElementById("paypad-display");
    const confirmPaymentBtn = document.getElementById("confirm-payment-btn");
    const cashBtn = document.getElementById("cash-btn");
    const cardBtn = document.getElementById("card-btn");
    const closePaypadBtn = document.getElementById("close-paypad-btn");
    const paypadButtons = document.querySelectorAll(".paypad-btn");

    // ===== OPEN/CLOSE PAYPAD =====
    if (cashBtn) cashBtn.addEventListener("click", () => {
      activeMethod = "cash";
      paypadOverlay.classList.add("active");
      keypadBuffer = "";
      paypadDisplay.textContent = "$0.00";
    });
    if (cardBtn) cardBtn.addEventListener("click", () => {
      activeMethod = "card";
      paypadOverlay.classList.add("active");
      keypadBuffer = "";
      paypadDisplay.textContent = "$0.00";
    });
    if (closePaypadBtn) closePaypadBtn.addEventListener("click", () => {
      paypadOverlay.classList.remove("active");
    });

    // ===== PAYPAD INPUT =====
    paypadButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const v = btn.dataset.value;
        if (v === "C") keypadBuffer = "";
        else if (v === "‚Üê") keypadBuffer = keypadBuffer.slice(0, -1);
        else if (v === ".") {
          if (!keypadBuffer.includes(".")) keypadBuffer += ".";
        } else {
          keypadBuffer += v;
        }
        const displayAmount = parseFloat(keypadBuffer || "0") || 0;
        paypadDisplay.textContent = money(displayAmount);
      });
    });

    // ===== CONFIRM PAYMENT =====
    if (confirmPaymentBtn) confirmPaymentBtn.addEventListener("click", () => {
      const entered = parseFloat(paypadDisplay.textContent.replace(/[^0-9.]/g, "")) || 0;
      if (activeMethod === "cash") cashPaid += entered;
      else if (activeMethod === "card") cardPaid += entered;

      keypadBuffer = "";
      paypadDisplay.textContent = "$0.00";
      syncDisplays();
      paypadOverlay.classList.remove("active");
    });

    // Helper
    window.getTotalPaid = () => cashPaid + cardPaid;
  });
  </script>

  <!-- ===== FIXED OVERLAY BEHAVIOR ===== -->
  <style>
  .overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(6px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  .overlay.active {
    display: flex;
    opacity: 1;
    pointer-events: all;
  }

  .hidden {
    display: none !important;
  }
  </style>
</body>
</html>
